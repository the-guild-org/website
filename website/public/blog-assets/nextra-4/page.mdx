---
title: Nextra 4 RC.0 x App Router
description:
  App Router, Turbopack, new Rust search Pagefind, RSC i18n, server/client components, smallest
  bundle size EVER for a Nextra-powered website, GitHub Alert Syntax
date: 2024-11-04
authors: [dimitri]
image: https://nextra.site/og?title=Nextra%204%0AApp%20Router%20/%20Turbopack
tags: [react, nextra, nextjs, app-router, turbopack, pagefind, rsc, i18n]
---

import { Button, FileTree, Steps } from 'nextra/components'
import ExampleLayoutForBlogTheme from './example-layout-for-blog-theme.mdx'
import ExampleLayoutForDocsTheme from './example-layout-for-docs-theme.mdx'
import ExampleLayoutForI18nDocsTheme from './example-layout-for-i18n-docs-theme.mdx'
import GitHubAlertSyntax from './github-alert-syntax.mdx'

export function ExclamationTriangleIcon(props) {
  return (
    <svg viewBox="0 0 15 15" fill="currentColor" {...props}>
      <path d="M8.4449 0.608765C8.0183 -0.107015 6.9817 -0.107015 6.55509 0.608766L0.161178 11.3368C-0.275824 12.07 0.252503 13 1.10608 13H13.8939C14.7475 13 15.2758 12.07 14.8388 11.3368L8.4449 0.608765ZM7.4141 1.12073C7.45288 1.05566 7.54712 1.05566 7.5859 1.12073L13.9798 11.8488C14.0196 11.9154 13.9715 12 13.8939 12H1.10608C1.02849 12 0.980454 11.9154 1.02018 11.8488L7.4141 1.12073ZM6.8269 4.48611C6.81221 4.10423 7.11783 3.78663 7.5 3.78663C7.88217 3.78663 8.18778 4.10423 8.1731 4.48612L8.01921 8.48701C8.00848 8.766 7.7792 8.98664 7.5 8.98664C7.2208 8.98664 6.99151 8.766 6.98078 8.48701L6.8269 4.48611ZM8.24989 10.476C8.24989 10.8902 7.9141 11.226 7.49989 11.226C7.08567 11.226 6.74989 10.8902 6.74989 10.476C6.74989 10.0618 7.08567 9.72599 7.49989 9.72599C7.9141 9.72599 8.24989 10.0618 8.24989 10.476Z" />
    </svg>
  )
}

export function Removed({ children }) {
  return (
    <span className="text-yellow-500">
      <ExclamationTriangleIcon height="15" className="inline" /> Removed
      {children && <>. {children}</>}
    </span>
  )
}

export function Video({ src, alt }) {
  return (
    <>
      <video autoPlay="autoplay" loop muted playsInline className="mt-6 rounded-md">
        <source src={src} type="video/mp4" />
        Your browser does not support the video tag.
      </video>
      <p className="mt-2 text-center text-sm italic">{alt}</p>
    </>
  )
}

<br />

## App Router Support

[Pages Router](https://nextjs.org/docs/pages) support has been removed, Nextra 4 is fully compatible
with Next.js [App Router](https://nextjs.org/docs/app).

### New 2 Rendering Modes

#### `content` Directory Convention

The first mode is the easiest way to migrate your existing Nextra website from Pages router. To do
follow these steps:

<Steps>

<h5>Rename your `pages` folder to `content`</h5>

<h5>Ensure `content` directory is placed in root of your project</h5>

<h5>Add `useContentDir: true` in `next.config` file</h5>

```js filename="next.config.mjs" {4}
import nextra from 'nextra'

const withNextra = nextra({
  useContentDir: true
})
```

<h5>Add `[[...mdxPath]]/page.jsx` file</h5>

Place this file in `app` directory with
[the following content](https://github.com/shuding/nextra/blob/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/docs/app/%5B%5B...mdxPath%5D%5D/page.jsx),
you should get the following structure:

<FileTree>
  <FileTree.Folder name="app" open>
    <FileTree.File name="layout.jsx" />
    <FileTree.Folder name="[[...mdxPath]]" open active>
      <FileTree.File name="page.jsx" active />
    </FileTree.Folder>
    <FileTree.Folder name="content" open>
      <FileTree.File name="index.mdx" />
      <FileTree.Folder name="docs" open>
        <FileTree.File name="index.mdx" />
        <FileTree.File name="getting-started.mdx" />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

> [!TIP]
>
> Consider the single catch-all route `[[...mdxPath]]/page.jsx` as a gateway to your `content`
> directory.

<h5>You are ready to go!</h5>

> [!NOTE]
>
> In Web you can found article such as
> [Refreshing the Next.js App Router When Your Markdown Content Changes](https://steveruiz.me/posts/nextjs-refresh-content)
> where you need to install unnecessary dependency like `concurrently` and `ws`, mentioned article
> is adapted on
> [Dan Abramov workaround with `<AutoRefresh>` component and dev web socket server](https://github.com/hashicorp/next-remote-watch/issues/42#issuecomment-1794052655).
> Nextra's `useContentDir` mode provide ultimate DX:
>
> - you don't need to install unnecessary dependencies
> - you don't need to restart your server on changes in `content` directory
> - hot reloading works out of box
> - you can use `import` statements in MDX files and
>   [static images](https://nextra.site/docs/guide/image#static-image) works as well
>
> See Nextra's
> [example of docs website](https://github.com/shuding/nextra/tree/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/docs)
> and
> [i18n website example](https://github.com/shuding/nextra/tree/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/swr-site)
> as an examples of this mode.

</Steps>

#### `page` File Convention

The second mode follows
[Next.js App Router convention](https://nextjs.org/docs/getting-started/project-structure#app-routing-conventions)
but with enhanced page extensions as `page.{md,mdx}` and don't requires additional steps to setup.

Above [`content` directory convention structure](#add-mdxpathpagejsx-file), with this mode will
looks like:

<FileTree>
  <FileTree.Folder name="app" open>
    <FileTree.File name="layout.jsx" />
    <FileTree.File name="page.jsx" active />
    <FileTree.Folder name="docs" open>
      <FileTree.File name="page.mdx" active />
      <FileTree.Folder name="getting-started" open>
        <FileTree.File name="page.mdx" active />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

> [!NOTE]
>
> See
> [Nextra website](https://github.com/shuding/nextra/tree/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/docs)
> or Nextra's
> [blog example](https://github.com/shuding/nextra/tree/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/blog)
> as an examples of this mode.

## Turbopack Support

After [almost 2 years of requesting this feature](https://github.com/shuding/nextra/issues/1054),
Nextra 4 supports [Turbopack](https://nextjs.org/docs/architecture/turbopack), incremental bundler
written in Rust. To benefit it, simple append the `--turbopack` flag to your development command:

```diff filename="package.json"
"scripts": {
-  "dev": "next dev"
+  "dev": "next dev --turbopack"
}
```

> [!NOTE]
>
> Without `--turbopack` flag Next.js under the hood uses
> [Webpack](https://github.com/webpack/webpack), written in JavaScript.

> [!WARNING]
>
> Only serializable options are supported:
>
> At the time of writing this blog **only JSON serializable values** can be passed in `nextra`
> function. This mean that with Turbopack enabled you can't pass custom `remarkPlugins`,
> `rehypePlugins` or `recmaPlugins` since they are functions.
>
> The following options could be passed only without Turbopack or only while building your app with
> `next build`
> ([since Turbopack isn't support `next build` for now](https://nextjs.org/docs/architecture/turbopack#unsupported-features)
> and Webpack is used instead).
>
> ```js filename="next.config.mjs" {5-7}
> import nextra from 'nextra'
>
> const withNextra = nextra({
>   mdxOptions: {
>     remarkPlugins: [myRemarkPlugin],
>     rehypePlugins: [myRehypePlugin],
>     recmaPlugins: [myRecmaPlugin]
>   }
> })
> ```
>
> If you try to pass them, you'll get an error from Turbopack:
>
> ```text copy=false
> Error: loader nextra/loader for match "./{src/app,app}/**/page.{md,mdx}" does not have serializable options.
> Ensure that options passed are plain JavaScript objects and values.
> ```

## Drop Support of `theme.config` Files

Nextra 4 no longer support `theme.config` files, which were previously used for configuring your
theme options, `theme` and `themeConfig` option were removed:

```diff filename="next.config.mjs"
const withNextra = nextra({
- theme: 'nextra-theme-docs',
- themeConfig: './theme.config.tsx'
})
```

> [!NOTE]
>
> Previously theme config options now should be passed as `props` for `<Layout>`, `<Navbar>`,
> `<Footer>`, `<Search>` and `<Banner>` components in `app/layout.jsx` file.

## New Search Engine – Pagefind

Search engine was migrated from [Flexsearch](https://github.com/nextapps-de/flexsearch) written in
JavaScript to Rust-powered [Pagefind](https://pagefind.app).

### Benefits

Pagefind is _**MUCH**_ faster and has _**MUCH**_ better search results than Flexsearch:

1. Indexing remote MDX

   {/* prettier-ignore */}
   ```mdx filename="page.mdx" "{await getUpdatedAt()}" "<Stars />"
    import { Callout } from 'nextra/components'

    export async function Stars() {
      const response = await fetch('https://api.github.com/repos/shuding/nextra')
      const repo = await response.json()
      const stars = repo.stargazers_count
      return <b>{stars}</b>
    }
    export async function getUpdatedAt() {
      const response = await fetch('https://api.github.com/repos/shuding/nextra')
      const repo = await response.json()
      const updatedAt = repo.updated_at
      return new Date(updatedAt).toLocaleDateString()
    }

    <Callout emoji="🏆">
      {/* Stars count will be indexed 🎉 */}
      Nextra has <Stars /> stars on GitHub!

      {/* Last update time will be indexed 🎉 */}
      Last repository update _{await getUpdatedAt()}_.
    </Callout>
    ```

1. Indexing dynamic content written in Markdown/MDX

   {/* prettier-ignore */}
   ```mdx filename="page.mdx" "{new Date().getFullYear()}"
    {/* Current year will be indexed 🎉 */}
    MIT {new Date().getFullYear()} © Nextra.
    ```

1. Indexing imported JavaScript or MDX files in MDX page

   ```jsx filename="../path/to/your/reused-js-component.js"
   export function ReusedJsComponent() {
     return <strong>My content will be indexed</strong>
   }
   ```

   ```mdx filename="../path/to/your/reused-mdx-component.mdx"
   **My content will be indexed as well**
   ```

   ```mdx filename="page.mdx"
   import { ReusedJsComponent } from '../path/to/your/reused-js-component.js'
   import ReusedMdxComponent from '../path/to/your/reused-mdx-component.mdx'

   <ReusedJsComponent />
   <ReusedMdxComponent />
   ```

1. Indexing static pages written in JavaScript or TypeScript

   ```jsx filename="page.jsx" /data-pagefind-body/ /data-pagefind-ignore/
   export default function Page() {
     return (
       // All content of tags with `data-pagefind-body` attribute will be indexed
       <ul data-pagefind-body>
         <li>Nextra 4 is the best MDX Next.js library</li>
         {/* Except for tags with `data-pagefind-ignore` attribute */}
         <li data-pagefind-ignore>Nextra 3 is the best MDX Next.js library</li>
       </ul>
     )
   }
   ```

> [!NOTE]
>
> 1. No one of the above examples didn't work in previous versions of Nextra
> 1. For JavaScript/TypeScript pages **you must add**{''}
>    [`data-pagefind-body` attribute](https://pagefind.app/docs/indexing/#limiting-what-sections-of-a-page-are-indexed)
>    to tag your main content area which you want to index
> 1. You can ignore indexing of specific tags by adding
>    [`data-pagefind-ignore` attribute](https://pagefind.app/docs/indexing/#removing-individual-elements-from-the-index)
> 1. For MDX pages while using `nextra-theme-docs` and `nextra-theme-blog` **you don't need to
>    add**{' '} `data-pagefind-body` attribute

### Setup [#pagefind-setup] {/* eslint-disable-line */}

New search engine requires few steps to setup:

<Steps>
<h4>Instal `pagefind` as `devDependency`</h4>
```sh npm2yarn
npm i -D pagefind
```
<h4>Add `postbuild` script</h4>

Pagefind indexes `.html` pages and search indexing should be done after building your application:

```json filename="package.json" {4}
"scripts": {
  "dev": "next --turbopack",
  "build": "next build",
  "postbuild": "pagefind --site .next/server/app --output-path public/_pagefind"
}
```

<h4>Enable `pre`/`post` scripts (_optional_)</h4>

Some package managers like `pnpm@8` by default
[don't execute `pre/post` scripts](https://pnpm.io/8.x/cli/run#enable-pre-post-scripts), you should
enable it via `.npmrc` file via `enable-pre-post-scripts` setting:

```text filename=".npmrc"
enable-pre-post-scripts=true
```

> [!NOTE]
>
> `pnpm@9` by default
> [run `pre`/`post` scripts](https://pnpm.io/9.x/cli/run#enable-pre-post-scripts).

<h4>Add `_pagefind/` directory to `.gitignore` file</h4>

You don't need to commit `_pagefind/` directory to your git repository, he should be always newly
generated.

```text filename=".gitignore" {3}
node_modules/
.next/
_pagefind/
```

<h4>Use `<Search>` component in your custom theme</h4>

Search from `nextra-theme-docs` was exported in `nextra/components`. With this change
`nextra-theme-blog` received search feature too. And you can benefit from it as well in your custom
themes.

```jsx filename="app/layout.jsx" {1,8}
import { Search } from 'nextra/components'

export function RootLayout({ children }) {
  return (
    <html>
      <body>
        <header>
          <Search />
        </header>
        <main>{children}</main>
      </body>
    </html>
  )
}
```

</Steps>

## Smallest Bundle Size _**`EVER`**_ for a Nextra-Powered Website

> [!WARNING]
>
> TODO

## RSC I18n Support

Thanks to server components, we no longer need to ship to client translation dictionary files, e.g
`./dictionaries/en.json`. We can dynamically load translations in server components and pass
according translation as `props` to `<Layout>`, `<Banner>`, `<Footer>`, etc. components in
`app/[lang]/layout.jsx`.

### Example

Below an example of server components i18n using `nextra-theme-docs`, but the same approach should
be applied for your custom theme:

<ExampleLayoutForI18nDocsTheme />

where `get-dictionary` file may looks like:

```js filename="../path/to/your/get-dictionary.js"
// Ensure this file is always called in server component
import 'server-only'

// Enumerate all dictionaries
const dictionaries = {
  en: () => import('./en.json'),
  fr: () => import('./fr.json'),
  ru: () => import('./ru.json')
}

export async function getDictionary(locale) {
  const { default: dictionary } = await (dictionaries[locale] || dictionaries.en)()

  return dictionary
}

export function getDirection(locale) {
  switch (locale) {
    case 'he':
      return 'rtl'
    default:
      return 'ltr'
  }
}
```

> [!NOTE]
>
> Read more about server components i18n in
> [Next.js docs](https://nextjs.org/docs/app/building-your-application/routing/internationalization).<br/>
> See
> [working example of i18n website](https://github.com/shuding/nextra/tree/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/swr-site)
> in Nextra's examples.

## GitHub Alert Syntax

<GitHubAlertSyntax />

## `nextra-theme-docs`

### Zustand

All previous React context usages were migrated to [zustand](https://github.com/pmndrs/zustand)
except places where we need
[dependency injection](https://en.wikipedia.org/wiki/Dependency_injection). This applies only to the
`useConfig` and `useThemeConfig` hooks which needs
[initialize their state with props](https://zustand.docs.pmnd.rs/guides/initialize-state-with-props).

### Headings Have Animation for `:target` State

<Video
  alt="Example animation for headings for `:target` state"
  src="/blog-assets/nextra-4/heading-target-animation.mp4"
/>

### Migration Guide

<Steps>
<h4>Choose [MDX rendering mode](#new-2-rendering-modes)</h4>

<h4>Add `layout.jsx` file</h4>

Example of `app/layout.jsx` for Nextra documentation theme:

<ExampleLayoutForDocsTheme />

<h4 id="use-mdx-components">Add an `mdx-components.jsx` file</h4>

Create an `mdx-components.jsx` file in the root of your project to define global MDX Components:

```jsx filename="mdx-components.jsx"
import { useMDXComponents as getDocsMDXComponents } from 'nextra-theme-docs'

const docsComponents = getDocsMDXComponents()

export function useMDXComponents(components) {
  return {
    ...docsComponents,
    ...components
    // ... your additional components
  }
}
```

<h4>Migrate `theme.config` options</h4>

<details>
<summary>Table of migration `theme.config` options</summary>

| Nextra 3                           | Nextra 4                                                                                                                             |
| ---------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| `banner.content`                   | `children` prop in `<Banner>`[^1]                                                                                                    |
| `banner.dismissible`               | `dismissible` prop in `<Banner>`                                                                                                     |
| `banner.key`                       | `storageKey` prop in `<Banner>`                                                                                                      |
| `backgroundColor.dark`             | `backgroundColor.dark` prop in `<Head>`[^2]                                                                                          |
| `backgroundColor.light`            | `backgroundColor.light` prop in `<Head>`                                                                                             |
| `chat.icon`                        | `chatIcon` prop in `<Navbar>`[^3]                                                                                                    |
| `chat.link`                        | `chatLink` prop in `<Navbar>`                                                                                                        |
| `components`                       | <Removed>Provide custom components inside [`useMDXComponents` function](#use-mdx-components)</Removed>                               |
| `darkMode`                         | `darkMode` prop in `<Layout>`[^4]                                                                                                    |
| `direction`                        | <Removed>Use `dir` attribute on `<html>` tag</Removed>                                                                               |
| `docsRepositoryBase`               | `docsRepositoryBase` prop in `<Layout>`                                                                                              |
| `editLink.component`               | `editLink` prop in `<Layout>`                                                                                                        |
| `editLink.content`                 | `children` prop in `<LastUpdated>`[^5]                                                                                               |
| `faviconGlyph`                     | `faviconGlyph` prop in `<Head>`                                                                                                      |
| `feedback.content`                 | `feedback.content` prop in `<Layout>`                                                                                                |
| `feedback.labels`                  | `feedback.labels` prop in `<Layout>`                                                                                                 |
| `feedback.useLink`                 | <Removed />                                                                                                                          |
| `footer.component`                 | `footer` prop in `<Layout>`                                                                                                          |
| `footer.content`                   | `children` prop in `<Footer>`[^6]                                                                                                    |
| `gitTimestamp`                     | `lastUpdated` prop in `<Layout>`                                                                                                     |
| `head`                             | <Removed>Use `<Head>` or Next.js [Metadata API](https://nextjs.org/docs/app/building-your-application/optimizing/metadata)</Removed> |
| `i18n[number].direction`           | <Removed>Use `dir` attribute on `<html>` tag</Removed>                                                                               |
| `i18n[number].locale`              | `i18n[number].locale` prop in `<Layout>`                                                                                             |
| `i18n[number].name`                | `i18n[number].name` prop in `<Layout>`                                                                                               |
| `logo`                             | `logo` prop in `<Navbar>`                                                                                                            |
| `logoLink`                         | `logoLink` prop in `<Navbar>`                                                                                                        |
| `main`                             | <Removed />                                                                                                                          |
| `navbar.component`                 | `navbar` prop in `<Layout>`                                                                                                          |
| `navbar.extraContent`              | `children` prop in `<Layout>`                                                                                                        |
| `navigation`                       | `navigation` prop in `<Layout>`                                                                                                      |
| `nextThemes`                       | `nextThemes` prop in `<Layout>`                                                                                                      |
| `notFound.content`                 | `content` prop in `<NotFoundPage>`[^7]                                                                                               |
| `notFound.labels`                  | `labels` prop in `<NotFoundPage>`                                                                                                    |
| `color.hue`                        | `color.hue` prop in `<Head>`                                                                                                         |
| `color.saturation`                 | `color.saturation` prop in `<Head>`                                                                                                  |
| `project.icon`                     | `projectIcon` prop in `<Navbar>`                                                                                                     |
| `project.link`                     | `projectLink` prop in `<Navbar>`                                                                                                     |
| `search.component`                 | `search` prop in `<Layout>`                                                                                                          |
| `search.emptyResult`               | `emptyResult` prop in `<Search>`[^8]                                                                                                 |
| `search.error`                     | `errorText` prop in `<Search>`                                                                                                       |
| `search.loading`                   | `loading` prop in `<Search>`                                                                                                         |
| `search.placeholder`               | `placeholder` prop in `<Search>`                                                                                                     |
| `sidebar.autoCollapse`             | `sidebar.autoCollapse` prop in `<Layout>`                                                                                            |
| `sidebar.defaultMenuCollapseLevel` | `sidebar.defaultMenuCollapseLevel` prop in `<Layout>`                                                                                |
| `sidebar.toggleButton`             | `sidebar.toggleButton` prop in `<Layout>`                                                                                            |
| `themeSwitch.component`            | <Removed />                                                                                                                          |
| `themeSwitch.useOptions`           | `themeSwitch` prop in `<Layout>`                                                                                                     |
| `toc.backToTop`                    | `toc.backToTop` prop in `<Layout>`                                                                                                   |
| `toc.component`                    | <Removed />                                                                                                                          |
| `toc.extraContent`                 | `toc.extraContent` prop in `<Layout>`                                                                                                |
| `toc.float`                        | `toc.float` prop in `<Layout>`                                                                                                       |
| `toc.title`                        | `toc.title` prop in `<Layout>`                                                                                                       |

</details>

</Steps>

## `nextra-theme-blog`

### `react-cusdis` Was Removed

Previously optional peer dependency `react-cusdis` was removed, since:

- this library is no longer maintained
- has only React 17 specified in `peerDependencies`

We use [Cusdis SDK](https://cusdis.com/doc#/advanced/sdk) directly in `<Comments>`[^9] component.

### `next-view-transitions` Was Added

Blog received support of
[View Transitions API](https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API) by
using [`next-view-transitions`](https://github.com/shuding/next-view-transitions) package.

<Video alt="Demo View Transitions API" src="/blog-assets/nextra-4/view-transitions-api.mp4" />

### Use Built-In Nextra `<Search>`

`nextra-theme-blog` v4 is the first version where you can use built-in search. To do it, import
`<Search>` component from `nextra/components` and place it as children of `<Navbar>` component, then
follow [search setup steps](#pagefind-setup).

```jsx filename="app/layout.jsx" {7}
<Navbar
  navs={[
    { url: '/', name: 'About' },
    { url: '/posts', name: 'Posts' }
  ]}
>
  <Search />
  <ThemeSwitch />
</Navbar>
```

### Migration Guide

<Steps>
<h4>Choose [MDX rendering mode](#new-2-rendering-modes)</h4>
<h4>Migrate `theme.config` options</h4>
<h4>Add `layout.jsx` file</h4>

Example of `app/layout.jsx` for Nextra blog theme:

<ExampleLayoutForBlogTheme />

<h4 id="use-mdx-components2">Add an `mdx-components.jsx` file</h4>

Create an `mdx-components.jsx` file in the root of your project to define global MDX Components:

```jsx filename="mdx-components.jsx"
import { useMDXComponents as getBlogMDXComponents } from 'nextra-theme-blog'

const blogComponents = getBlogMDXComponents()

export function useMDXComponents(components) {
  return {
    ...blogComponents,
    ...components
    // ... your additional components
  }
}
```

<details>
<summary>Table of migration `theme.config` options</summary>

| Nextra 3        | Nextra 4                                                                                                                                                                                                                                 |
| --------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `comments`      | Provide your comments component in post layout, e.g. [`app/posts/(with-comments)/layout.jsx` file](<https://github.com/shuding/nextra/blob/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/blog/app/posts/(with-comments)/layout.jsx>) |
| `components`    | Provide custom components inside [`useMDXComponents` function](#use-mdx-components2)                                                                                                                                                     |
| `darkMode`      | To disable theme toggle [remove `<ThemeSwitch>` from `<Navbar>`](https://github.com/shuding/nextra/blob/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/blog/app/layout.jsx#L31)                                                       |
| `dateFormatter` | Provide `DateFormatter` component inside [`useMDXComponents` function](#use-mdx-components2)                                                                                                                                             |
| `footer`        | Provide your `<Footer>` component as last child of `<Layout>`                                                                                                                                                                            |
| `head`          | Use `<Head>` or Next.js [Metadata API](https://nextjs.org/docs/app/building-your-application/optimizing/metadata)                                                                                                                        |
| `navs`          | Use `navs` prop on `<Navbar>`. Provide your `<Navbar>` component as first child of `<Layout>`                                                                                                                                            |
| `postFooter`    | Provide your post footer in post layout, e.g. [`app/posts/(with-comments)/layout.jsx` file](<https://github.com/shuding/nextra/blob/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/blog/app/posts/(with-comments)/layout.jsx>)        |
| `readMore`      | Provide `readMore` prop for [`<PostCard>` component](https://github.com/shuding/nextra/blob/d5cb1bc0e84494cbcc8decbae56fb091ce9999f0/examples/blog/app/posts/page.jsx#L30)                                                               |
| `titleSuffix`   | Use Next.js [Metadata API](https://nextjs.org/docs/app/building-your-application/optimizing/metadata)                                                                                                                                    |
|                 | **New** `banner` prop on `<Layout>`. E.g. you can now provide Nextra's `<Banner>`[^1]                                                                                                                                                    |
|                 | **New** `nextThemes` prop on `<Layout>`. Configuration options can be found in [`next-themes` docs](https://github.com/pacocoursey/next-themes#themeprovider)                                                                            |

</details>
</Steps>

## Various Changes

### Bump Minimal Next.js to V14

Nextra 4 requires at least Next.js 14 to be installed in your project.

### Update Your `tsconfig.json`

If you are using TypeScript and have `moduleResolution` set to `node`, you will receive type errors:

```text
Type error: Cannot find module 'nextra/components' or its corresponding type declarations.
```

`"typesVersions"` fields from `package.json`'s of Nextra packages were removed. You need to set
`"moduleResolution": "bundler"` in your `tsconfig.json`.

```diff filename="tsconfig.json"
{
  "compilerOptions": {
-   "moduleResolution": "node"
+   "moduleResolution": "bundler"
  }
}
```

### Overriding Code Block Icons

You can now override or add additional icons for code blocks. Here is an example how to do it for
`nextra-theme-docs`, but it's the same approach for custom themes. Import `withIcons` HOC function
from `nextra/components`, Wrap the `Pre` component with `withIcons`, passing in your custom icon for
the desired language.

```jsx filename="mdx-components.jsx"
import { useMDXComponents as useDocsMDXComponents } from 'nextra-theme-docs'
import { Pre, withIcons } from 'nextra/components'

const docsComponents = getDocsMDXComponents({
  pre: withIcons(Pre, { js: MyCustomIcon })
})

export function useMDXComponents(components) {
  return {
    ...docsComponents,
    ...components
    // ... your additional components
  }
}
```

### Component Migration: Moving UI Elements

Several components were migrated from `nextra-theme-docs` to `nextra/components` to make them
accessible for use in your custom themes:

- `<Collapse>`
- `<Details>`
- `<Summary>`
- `<SkipNavContent>`
- `<SkipNavLink>`
- `<Select>`
- `<Bleed>`
- `<Head>`

> [!TIP]
>
> With migration `<Head>` component to `nextra/components`, both `nextra-theme-blog` and your custom
> themes can now configure:
>
> - primary color, `color` prop
> - background color, `backgroundColor` prop
> - glyph to use as the favicon, `faviconGlyph` prop
> - color of selection based on primary color
>
> Previously all of these options were exclusive to `nextra-theme-docs` only

All built-in Nextra components were refactored to be either server or client.

<details>
<summary>Table of comparison components from `nextra/components`</summary>

Here’s the table sorted alphabetically by component name:

| Component           | Type       |
| ------------------- | ---------- |
| `<Banner>`          | **server** |
| `<Bleed>`           | **server** |
| `<Button>`          | _client_   |
| `<Callout>`         | **server** |
| `<Cards>`           | **server** |
| `<Cards.Card>`      | **server** |
| `<Collapse>`        | _client_   |
| `<FileTree>`        | **server** |
| `<FileTree.File>`   | **server** |
| `<FileTree.Folder>` | _client_   |
| `<Head>`            | **server** |
| `<Playground>`      | _client_   |
| `<Popup>`           | _client_   |
| `<RemoteContent>`   | **server** |
| `<Search>`          | _client_   |
| `<Select>`          | _client_   |
| `<SkipNavContent>`  | **server** |
| `<SkipNavLink>`     | _client_   |
| `<Tabs>`            | _client_   |
| `<Tabs.Tab>`        | _client_   |
| `<Steps>`           | **server** |

</details>

### Improvements for `_meta` Files

1. [zod](https://github.com/colinhacks/zod) now parses and transforms `_meta` files on server, to
   improve DX and avoid typos
1. The `_meta`'s `newWindow` field was removed
1. All external links declared in `_meta` files now opens in a new tab with with `rel="noreferrer"`
   attribute and have visual `↗` suffix icon

### External Markdown Links Have `↗` Suffix Icon

All external Markdown links declared in MDX files now opens in a new tab with with
`rel="noreferrer"` attribute and have visual `↗` suffix icon. (Was inspired from Next.js docs)

Example:

```mdx filename="example.mdx"
[dimaMachina](https://github.com/dimaMachina)
```

Will compiles to:

```jsx
<a href="https://github.com/dimaMachina" target="_blank" rel="noreferrer">
  dimaMachina&thinsp;
  <LinkArrowIcon height="16" className="_inline _align-baseline" />
</a>
```

### `::selection` Styles

Variant of primary color which is set via `color` prop on `<Head>` component is now used for
`::selection` styles.

## Next Steps

Nextra 4 is a major release with a lot of breaking changes. I plan to cut a stable release after a
couple of weeks of testing and receiving your feedback. I already created a roadmap for next major
release [Nextra 5](https://github.com/shuding/nextra/issues/3316), where the main goal will be using
new React compiler (for Nextra's packages) and optional using Rust-powered MDX
[`mdxjs-rs` parser](https://github.com/wooorm/mdxjs-rs). Share your thoughts as well.

## Credits

A sincere thank for
[the most active Nextra contributor](https://github.com/shuding/nextra/pulls?q=sort%3Aupdated-desc+is%3Apr+author%3A87xie),
I can even name him as a perfect example of a great Open Source contributor
[Oscar Xie](https://github.com/87xie)! His amazing contributions previously pushed me a lot to
release Nextra 3!

Huge thanks for Nextra sponsors:

- [GraphQL Hive – Open-source GraphQL platform](https://the-guild.dev/graphql/hive?utm_source=the-guild.dev&utm_campaign=nextra-4-blog&utm_content=blog_post)

- [Speakeasy – SDKs & Terraform Providers for Your API](https://speakeasy.com?utm_source=the-guild.dev&utm_campaign=nextra-4-blog&utm_content=blog_post)

[Become a Nextra's sponsor](https://github.com/sponsors/dimaMachina) and your logo will be visible
in Nextra GitHub repository and [Nextra website](https://nextra.site)!

Help spread the word about Nextra on [X](https://x.com) using the `#Nextra` hashtag. Also, feel free
to follow me on [X](https://x.com/dimaMachina_) and [GitHub](https://github.com/dimaMachina)!

---

[^1]: `import { Banner } from 'nextra/components'{:js}`

[^2]: `import { Head } from 'nextra/components'{:js}`

[^3]: `import { Navbar } from 'nextra-theme-docs'{:js}`

[^4]: `import { Layout } from 'nextra-theme-docs'{:js}`

[^5]: `import { LastUpdated } from 'nextra-theme-docs'{:js}`

[^6]: `import { Footer } from 'nextra-theme-docs'{:js}`

[^7]: `import { NotFoundPage } from 'nextra-theme-docs'{:js}`

[^8]: `import { Search } from 'nextra/components'{:js}`

[^9]: `import { Comments } from 'nextra-theme-blog'{:js}`
