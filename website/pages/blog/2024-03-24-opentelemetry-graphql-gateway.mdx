---
title: Monitoring GraphQL Gateways with OpenTelemetry
tags: [graphql, monitoring, opentelemetry, hive]
authors: [valentin]
date: 2024-03-23
description:
  Explore OpenTelemetry's role in GraphQL Gateway monitoring and Hive Gateway's latest improvements.
image: /blog-assets/opentelemetry-graphql/opentelemetry-logo.png
thumbnail: /blog-assets/opentelemetry-graphql/opentelemetry-thumbnail.png
---

## The Importance of Monitoring GraphQL Gateways

GraphQL Gateways play a crucial role in modern API architectures, acting as the central point for
request routing, schema composition, and performance optimization. As these gateways handle
increasing amounts of traffic and complexity, monitoring their performance and behavior becomes
essential for maintaining reliable and efficient systems.

## Current State of GraphQL Gateway Monitoring

Traditionally, monitoring GraphQL Gateways has been challenging due to several factors:

1. **Distributed Nature**: GraphQL Gateways often communicate with multiple subgraphs, making it
   difficult to trace requests across the entire system.
2. **Query Planning Complexity**: The gateway's query planning phase, which determines how to split
   and route queries across subgraphs, is a critical but often opaque process that can significantly
   impact performance.
3. **Performance Bottleneck Identification**: Complex queries that span multiple subgraphs make it
   challenging to identify which part of the execution is causing slowness, whether it's the
   gateway's planning, a specific subgraph, or the network communication.
4. **Error Source Tracing**: When errors occur, it's often difficult to trace whether they originate
   from the gateway itself, a specific subgraph, or the communication between them, making debugging
   a complex process.

## OpenTelemetry: A Game-Changer for GraphQL Monitoring

OpenTelemetry has emerged as a powerful solution for monitoring GraphQL Gateways, offering:

1. **Standardized Instrumentation**: OpenTelemetry provides consistent APIs for collecting metrics,
   traces, and logs across different programming languages and frameworks.
2. **Rich Context**: The ability to propagate context across service boundaries helps track requests
   through the entire system.
3. **Vendor Agnostic**: OpenTelemetry's vendor-agnostic approach allows you to choose your preferred
   observability backend.
4. **Open Source**: As an open-source project, OpenTelemetry perfectly aligns with The Guild's
   values of transparency and community-driven development.

## Key Metrics and Traces for GraphQL Gateways

When monitoring GraphQL Gateways with OpenTelemetry, several key metrics and traces are essential:

1. **Request Lifecycle Tracing**:

   - HTTP request/response spans
   - GraphQL operation execution spans
   - Query parsing and validation timing

2. **Subgraph Communication**:

   - Upstream HTTP fetch calls to subgraphs
   - Subgraph execution timing and status
   - Subgraph-specific error rates and latency

3. **Operation Performance**:
   - Overall query execution time
   - Subgraph-specific execution times
   - Error rates and types
   - Request throughput

## Hive Gateway's OpenTelemetry Integration

We're excited to announce significant improvements to Hive Gateway's OpenTelemetry integration.
These enhancements provide:

1. **Enhanced Tracing**:

   - Detailed request tracing across subgraphs
   - Automatic span creation for schema operations
   - Context propagation between services

2. **Comprehensive Metrics**:

   - Real-time performance metrics
   - Detailed error tracking
   - Resource utilization monitoring

3. **Improved Debugging**:
   - Better error context
   - Request/response correlation
   - Performance bottleneck identification

## Getting Started with Hive Gateway's OpenTelemetry Integration

You can try the new OpenTelemetry integration with Hive Gateway by simply enabling it in your
gateway configuration!

We support most used exporters out of the box, but you can also import your own custom ones.

> If you don't already have a tracing backend setup, you can use our
> [OpenTelemetry example repository](https://github.com/the-guild-org/graphql-gateway-otel/tree/main/otel)
> to get started.

```typescript
import { createOtlpHttpExporter, defineConfig } from "@graphql-hive/gateway";
import { createOtlpHttpExporter, setupOpenTelemetry } from "@graphql-hive/opentelemetry-setup";

setupOpenTelemetry({
  exporters: [
    createOtlpHttpExporter({ url: "http://localhost:4317" }),
  ],
});

export const gatewayConfig = defineConfig({
  openTelemetry: {
    tracing: true,
  }
});
```

This configuration enables OpenTelemetry tracing with HTTP OTLP exporter. The exporter will
automatically set up the Node.js OpenTelemetry SDK and ensure trace context is properly propagated
across service boundaries.

## Future Improvements

The OpenTelemetry integration we're releasing today lays the foundation for several exciting future
improvements. Thanks to OpenTelemetry's unified context, metrics, logs, and traces will be
automatically correlated, making it easier to debug errors and performance issues. When a problem
occurs, you'll be able to jump from a slow query trace directly to the relevant logs and metrics,
providing a complete picture of what happened during problematic requests.

## Conclusion

Hive Gateway's new OpenTelemetry integration brings comprehensive monitoring capabilities to your
GraphQL infrastructure. By providing detailed traces, metrics, and logs with unified context, it
helps you identify and resolve issues faster, whether they're in the gateway, subgraphs, or the
communication between them.

To learn more about Hive Gateway's OpenTelemetry integration or to get started with monitoring your
GraphQL Gateway, visit our [documentation](https://docs.graphql-hive.com) or contact our team.
