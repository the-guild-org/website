import withArticle from '../../ui/blog/article';

export const meta = {
  title: 'How I helped improve Angular Console',
  tags: [],
  date: '2018-11-30',
  description: 'TODO:',
  image:
    'https://github.com/the-guild-org/oneblog/blob/master/img/704/1*xBk9L_j521FRuqLTLjyFkg@2x.png?raw=true',
};

export default withArticle({ ...meta });

## By doing GraphQL right

In this guest blog post by Kamil Kisiela for the [blog of Nrwl](https://blog.nrwl.io/) , Kamil covers the topic of the new Angular Console product. Nrwl is an Angular consulting, training and developer product firm.

_If you like this, click the_ ðŸ‘ s*o other people will see it. Follow [@â€‹nrwl_io](https://medium.com/@nrwl_io) to read more!*

Did you know that **Angular Console** uses **GraphQL** under the hood? I want to tell about how it used it and how I helped to improve it because that might be useful for people trying to implement GraphQL in their applications, both on client and server.

> [Angular Console](http://angularconsole.com) is a user interface for Angular CLI created by [Nrwl](http://medium.com/nrwl), supported by [Angular](http://medium.com/angular-blog) team. Itâ€™s widely used in Angular Community.
>
> I will link to the PRs Iâ€™ve made to Angular Console throughout the article so you could see everything I recommend in practice.

After reading [the announcement](https://blog.nrwl.io/angular-console-the-ui-for-the-angular-cli-a5d0924240b7) of **Angular Console** I got very excited about the tool and immediately decided to explore the codebase. I noticed **Electron** and that the project is based on **Angular CLI** and Nrwlâ€™s **NX**.

Thatâ€™s super cool but what I found the most interesting was

> ### GraphQL.

As a freelancer, I work on daily basis with [The Guild](http://medium.com/the-guild). Most of our projects are built with GraphQL. Throughout the 3 years of adopting it, our team **tested practices and developed open source tools that helped to improve our workflow**.

So when I saw the first implementation, I thought it would be nice to share some ideas and implement some code that might help to improve the GraphQL part of Angular Console.

---

## Apollo Angular as the GraphQL client

I was hoping to find [**Apollo Angular**](https://github.com/apollographql/apollo-angular) as one of dependencies. I might be a bit bias as the author of that library but our team used it in all of our angular based projects with huge success.

> KLM and AirFrance runs on Apollo Angular

Okay, but just like in REST, you donâ€™t need sophisticated tools to communicate with the API. Simple `fetch` or Angularâ€™s `HttpClient` is far enough. Why then the GraphQL client?

Having a client, like Apollo, allows you to easily execute GraphQL operations and by having a cache layer, fetched data stays consistent across all components. Dhaivat Pandya explains it well in his [_â€œWhy you might want a GraphQL client_](https://blog.apollographql.com/why-you-might-want-a-graphql-client-e864050f789c)_â€ post_.

Apollo has a comprehensive [documentation](https://www.apollographql.com/docs/angular/) that covers a lot of use cases and I highly recommend to read it.

---

## Using DI to create Apollo

Angular Console used an old way of initializing Apollo. In one of the recent versions of Apollo Angular I introduced `APOLLO_OPTIONS`, an InjectionToken that provides a configuration object to Apollo service. The old API caused an issue with a race condition where a service tried to use Apollo before it got created.

[https://github.com/nrwl/angular-console/pull/158](https://github.com/nrwl/angular-console/pull/158 'Use APOLLO_OPTIONS by kamilkisiela Â· Pull Request #158 Â· nrwl/angular-console
Hi guys, thanks for using Apollo! :) I refactored a bit the way you initialize Apollo. Thereâ€™s a InjectionToken for itâ€¦github.com')

That was the first, very small PR. Next PR brought more changes and was focused only on the server.

## Apollo Server 2.0

I replaced `express-graphql` with a more complete solution, Apollo Server. This move helped to improve developer experience by having a **built-in support for GraphQL Subscription**, file uploading and error handling. Iâ€™m pretty sure the team behind Angular Console have plans to take advantage of it and implement subscriptions in the app, for example to replace currently used polling technique.

## Schema Definition Language

SDL, in short, is a syntax that allows to define GraphQL Schema, so instead of using GraphQLâ€™s API, you simply write everything as string.

For example, using `GraphQLObjectType` might look like this:

```typescript
new GraphQLObjectType({
  name: 'Post',
  fields: {
    id: {
      type: GraphQLString,
    },
    text: {
      type: GraphQLString,
    },
  },
});
```

with Schema Definition Language:

```graphql
type Post {
  id: String
  text: String
}
```

In my opinion, itâ€™s more convenient and way more intuitive to work with.

## Keeping resolve functions separated from SDL

In our projects, we try to group resolvers by GraphQL type and have them nearby the corresponding schema definition.

Having both, type definition and resolve functions in the `GraphQLObjectType` looks like that:

```typescript
new GraphQLObjectType({
  name: 'Post',
  fields: {
    id: {
      type: GraphQLString,
      resolve: (parent) => parent._id,
    },
    text: {
      type: GraphQLString,
      resolve: (parent) => parent.content,
    },
  },
});
```

I personally think it was a good choice because it forces developers to write logical part right next to type definition. The problem is, the bigger types the more confusing it gets. Also keeping resolvers as standalone functions makes them easier to test.

With Schema Definition Language, itâ€™s looks way better.

```typescript
const PostType = gql`
  type Post {
    id: String
    text: String
  }
`;

const Post = {
  id: (parent) => parent._id,
  text: (parent) => parent.content,
};
```

Here are the relevant changes that Iâ€™ve mentioned above, that allowed me to introduce something really interesting in the next PR.

[https://github.com/nrwl/angular-console/pull/175](https://github.com/nrwl/angular-console/pull/175 'Apollo Server 2.0, latest Apollo Angular, refactoring, SDL by kamilkisiela Â· Pull Request #175 Â·â€¦
Apollo Server 2.0 Latest Apollo Angular refactoring â€” moved files under /api directory used SDL instead of classes fromâ€¦github.com')

## Strongly typed resolvers

We love [TypeScript](https://typescriptlang.org) and we saw an opportunity to take our GraphQL servers to the next level. Instead of having `any` or defining interfaces for each resolver by hand, we decided to take advantage of one of our tools, called [GraphQL Code Generator](https://graphql-code-generator.com/) (thanks Dotan Simha for creating it).

In short, itâ€™s a tool to generate pretty much any piece of code, based on a GraphQL Schema. We use it a lot, mostly for types (server and client) but also to create MongoDB models, introspection files, Angular components and more.

In Angular Console, I used the TypeScript plugins to generate types for a schema and also for GraphQL Resolvers. Itâ€™s one of the pieces that makes your code even more strongly typed, from end to end.

Hereâ€™s how it might look like.

```typescript
import { PostResolvers } from './generated-types';

const Post: PostResolvers.Resolvers = {
  id: (parent) => parent._id,
  text: (parent) => parent.content,
};
```

```typescript
export interface PostParent {
  _id: string;
  content: string;
}
```

If you want to take a look at the changes and read about GraphQL Code Generator:

[https://github.com/nrwl/angular-console/pull/185](https://github.com/nrwl/angular-console/pull/185 'Use code generation to generate types for resolver and whole schema by kamilkisiela Â· Pull Requestâ€¦
It makes resolvers strongly typed. You can also use it on the client side, to generate types for each GraphQL query andâ€¦github.com')

We recently released another new version of the GraphQL Code Generator that fixed a lot of issues, introduced a feature called Mappers, made signatures of resolve functions more strict and handles multiple results in parallel.

[https://github.com/nrwl/angular-console/pull/413](https://github.com/nrwl/angular-console/pull/413 '[WIP] New GraphQL Code Generator by kamilkisiela Â· Pull Request #413 Â· nrwl/angular-console
New GraphQL Code Generator We changed the API a bit. Itâ€™s no longer required to use â€” flags with CLI, the codegenâ€¦github.com')

The GraphQL Code Generator is one powerful beast that enables any kind of code generation based just on GraphQL Schema (you can create your own custom generation templates).

## Named operations

GraphQL in most cases allows to use a shorthand syntax but putting a type and a name of an operation is very useful, simply for debugging and logging. Itâ€™s easier to track down a failed operation, because itâ€™s no longer anonymous and by keeping all names unique youâ€™re able to take advantage of any tool or service. One tool I described in the next chapter.

## Strongly typed operations and code generation

Fetching data with Apollo Angular, requires few steps:

- Import `Apollo` service
- Inject the service in a component
- Define GraphQL operation
- Wrap the operation with the `gql` tag
- Call `Apollo.watchQuery` with the operation
- Get an `Observable` with data

Thatâ€™s a lot, and in order to have everything strongly typed you even have to define extra interfaces that are specific for each operation.

```typescript
import { Apollo } from 'apollo-angular';
import gql from 'graphql-tag';

interface Post {
  id: string;
  text: string;
}

interface PostQuery {
  post: Post;
}

@Component({...})
export class PostComponent {
  @Input() postId: string;
  post: Observable<Post>;

  constructor(private apollo: Apollo) {}

  ngOnInit() {
    this.post = this.apollo.watchQuery<PostQuery>({
      query: gql`
        query getPost ($id: String!) {
          post(id: $id) {
            id
            text
          }
        }
     `,
     variables: {
       id: this.postId
     }
   })
     .valueChanges
     .pipe(
       map(result => result.data.post)
     );
  }
}
```

I wanted to share with Angular Console, something that we use and what helped to improve our workflow.

One interesting thing that weâ€™re able to achieve is the [`apollo-angular` code-generator plugin](https://graphql-code-generator.com/docs/plugins/typescript-apollo-angular).

Its main purpose is to generate strongly typed services for each GraphQL operation. Take a look at the following scientific visualization:

![](https://github.com/the-guild-org/oneblog/blob/master/img/704/1*m0Qci4KAiAjj075wn5PJLw.gif?raw=true 'This is how magic happens.')

Given the example I previously used, this is how it might look like with Apollo Angular plugin now.

- Write a query in a `.graphql` file
- Run the codegen _(has watch mode)_
- Use a **fully typed generated Angular service** directly in your component

```graphql
query getPost($id: String!) {
  post(id: $id) {
    id
    text
  }
}
```

```typescript
import { GetPostGQL, Post } from './generated/graphql';

@Component({...})
export class PostComponent {
  @Input() postId: string;
  post: Observable<Post>;

  constructor(
   private getPostGQL: GetPostGQL
  ) {}

  ngOnInit() {
    this.post = this.getPostGQL
      .watch({ id: this.postId })
      .valueChanges
      .pipe(
        map(result => result.data.post)
      );
  }
}
```

As you can see, we no longer use Apollo service directly (itâ€™s used under the hood) and every operation has now strongly typed API.

It wouldnâ€™t be possible without introducing this new API. I highly recommend to read an article linked below, it explains what it is and how it could be used with the codegen.

[https://medium.com/the-guild/apollo-angular-code-generation-7903da1f8559](https://medium.com/the-guild/apollo-angular-code-generation-7903da1f8559 'Apollo-Angular 1.2 â€” using GraphQL in your apps just got a whole lot easier!
Check whatâ€™s new in Apollo Angular and how to get the full potential benefits of using Angular + GraphQL + TypeScriptâ€¦medium.com')

I also prepared an explanation video that might help you to learn step by step, what code generation is and how to use it in a project.

[https://www.youtube.com/watch?v=KGBPODrjtKA](https://www.youtube.com/watch?v=KGBPODrjtKA 'GraphQL Code Generatorâ€Š - â€ŠAngular Apollo Template get the full potential benefits of using Angular + GraphQL + TypeScript combined thanks to GraphQL-Code-Generator. Generate a strongly typed Angular service, for every defined query, mutation or subscription, ready to use in your components!')

Here is the relevant PR introducing this change into Angular Console:

[https://github.com/nrwl/angular-console/pull/219](https://github.com/nrwl/angular-console/pull/219 'Use GraphQL Code Generator and Apollo Angular template by kamilkisiela Â· Pull Request #219 Â·â€¦
Adds apollo-angular template of GraphQL Code Generator to produce strongly typed services with more convenient API andâ€¦github.com')

---

[https://github.com/nrwl/angular-console/pull/263](https://github.com/nrwl/angular-console/pull/263 'Renovate by kamilkisiela Â· Pull Request #263 Â· nrwl/angular-console
We use renovate in all of our projects, super helpful to update dependencies. One PR per monorepos, for exampleâ€¦github.com')

## Summary

GraphQL is a very useful and fast growing technology. It helps with so many different use cases of developing applications, large and small. But donâ€™t forget that the ecosystem of GraphQL is huge and there are a lot of extra tools and best practices that might make it even more useful!

I hope this post was helpful for you to learn about some handy things in GraphQL.

If you want to read more about the GraphQL ecosystem and keep up with everything that happens around it, I would recommend also checking out [The Guildâ€™s Medium publication](https://medium.com/the-guild).
